# üîß Backend - API Console Rental System

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π REST API –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –∞—Ä–µ–Ω–¥—ã –∏–≥—Ä–æ–≤—ã—Ö –∫–æ–Ω—Å–æ–ª–µ–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Telegram –±–æ—Ç–∞, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∏—Å—Ç–æ—Ä–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π.

---

## üìã –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –ó–∞–ø—É—Å–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π)
npm run dev

# –ó–∞–ø—É—Å–∫ production
npm start

# –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–î —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
npm run seed
```

**API –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞**: `http://localhost:5000`

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –ø–∞–ø–∫–µ `backend/`:

```env
# MongoDB –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
MONGODB_URI=mongodb://localhost:27017/console-rental

# Telegram Bot Token (–ø–æ–ª—É—á–∏—Ç—å –æ—Ç @BotFather)
TELEGRAM_BOT_TOKEN=YOUR_TOKEN_HERE

# API URL
API_URL=http://localhost:5000

# –ü–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞
PORT=5000

# Node Environment
NODE_ENV=development
```

### 2. MongoDB

**–õ–æ–∫–∞–ª—å–Ω–æ:**
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ MongoDB Community
# –ó–∞–ø—É—Å–∫ MongoDB —Å–µ—Ä–≤–µ—Ä–∞
mongod
```

**MongoDB Atlas (–æ–±–ª–∞–∫–æ):**
```env
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/console-rental
```

### 3. Telegram Bot

1. –û—Ç–∫—Ä–æ–π—Ç–µ `@BotFather` –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot`
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω
4. –í—Å—Ç–∞–≤—å—Ç–µ –≤ `.env` –∫–∞–∫ `TELEGRAM_BOT_TOKEN`

---

## üìö API Endpoints

### üéÆ –ö–æ–Ω—Å–æ–ª–∏ (`/api/consoles`)

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|---------|
| `GET` | `/api/consoles` | –í—Å–µ –∫–æ–Ω—Å–æ–ª–∏ |
| `GET` | `/api/consoles/available` | –¢–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–Ω—Å–æ–ª–∏ |
| `GET` | `/api/consoles/:id` | –û–¥–Ω–∞ –∫–æ–Ω—Å–æ–ª—å –ø–æ ID |
| `POST` | `/api/consoles` | –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–æ–Ω—Å–æ–ª—å |
| `PUT` | `/api/consoles/:id` | –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å |
| `DELETE` | `/api/consoles/:id` | –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å |

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ - —Å–æ–∑–¥–∞–Ω–∏–µ:**
```bash
curl -X POST http://localhost:5000/api/consoles \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Xbox Series X",
    "type": "Home Console",
    "model": "XSX",
    "description": "Latest generation gaming console",
    "pricePerDay": 600,
    "games": []
  }'
```

---

### üéÆ –ò–≥—Ä—ã (`/api/games`)

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|---------|
| `GET` | `/api/games` | –í—Å–µ –∏–≥—Ä—ã |
| `GET` | `/api/games/:id` | –û–¥–Ω–∞ –∏–≥—Ä–∞ |
| `POST` | `/api/games` | –°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É |
| `PUT` | `/api/games/:id` | –û–±–Ω–æ–≤–∏—Ç—å –∏–≥—Ä—É |
| `DELETE` | `/api/games/:id` | –£–¥–∞–ª–∏—Ç—å –∏–≥—Ä—É |

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl -X POST http://localhost:5000/api/games \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Elden Ring",
    "description": "Action RPG masterpiece",
    "genre": "RPG",
    "year": 2022,
    "platform": "Xbox Series X"
  }'
```

---

### üìã –ê—Ä–µ–Ω–¥—ã (`/api/rentals`)

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|---------|
| `GET` | `/api/rentals` | –í—Å–µ –∞—Ä–µ–Ω–¥—ã |
| `GET` | `/api/rentals/user/:userId` | –ê—Ä–µ–Ω–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `GET` | `/api/rentals/:id` | –û–¥–Ω–∞ –∞—Ä–µ–Ω–¥–∞ |
| `POST` | `/api/rentals` | –°–æ–∑–¥–∞—Ç—å –∞—Ä–µ–Ω–¥—É |
| `PUT` | `/api/rentals/:id/complete` | –ó–∞–≤–µ—Ä—à–∏—Ç—å –∞—Ä–µ–Ω–¥—É |
| `DELETE` | `/api/rentals/:id` | –£–¥–∞–ª–∏—Ç—å –∞—Ä–µ–Ω–¥—É |

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ - —Å–æ–∑–¥–∞–Ω–∏–µ:**
```bash
curl -X POST http://localhost:5000/api/rentals \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "user_id_here",
    "consoleId": "console_id_here",
    "days": 5
  }'
```

---

### üè∑Ô∏è –°–∫–∏–¥–∫–∏ (`/api/discounts`)

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|---------|
| `GET` | `/api/discounts` | –í—Å–µ —Å–∫–∏–¥–∫–∏ |
| `GET` | `/api/discounts/check/:date` | –°–∫–∏–¥–∫–∞ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É (YYYY-MM-DD) |
| `POST` | `/api/discounts` | –°–æ–∑–¥–∞—Ç—å —Å–∫–∏–¥–∫—É |
| `PUT` | `/api/discounts/:id` | –û–±–Ω–æ–≤–∏—Ç—å —Å–∫–∏–¥–∫—É |
| `DELETE` | `/api/discounts/:id` | –£–¥–∞–ª–∏—Ç—å —Å–∫–∏–¥–∫—É |

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl -X POST http://localhost:5000/api/discounts \
  -H "Content-Type: application/json" \
  -d '{
    "date": "2025-02-14",
    "percentage": 25,
    "description": "Valentine Day Sale",
    "isGlobal": true
  }'
```

---

### ‚≠ê –†–µ–π—Ç–∏–Ω–≥–∏ (`/api/ratings`)

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|---------|
| `GET` | `/api/ratings/user/:userId` | –†–µ–π—Ç–∏–Ω–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `GET` | `/api/ratings/pending` | –û–∂–∏–¥–∞—é—â–∏–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∏ |
| `POST` | `/api/ratings` | –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ä–µ–π—Ç–∏–Ω–≥ |
| `PUT` | `/api/ratings/:id/approve` | –û–¥–æ–±—Ä–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥ |
| `PUT` | `/api/ratings/:id/reject` | –û—Ç–∫–ª–æ–Ω–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥ |
| `DELETE` | `/api/ratings/:id` | –£–¥–∞–ª–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥ |

**–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤:**
- `speed` - –°–∫–æ—Ä–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏
- `quality` - –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Å–æ–ª–∏
- `communication` - –ö–∞—á–µ—Å—Ç–≤–æ –æ–±—â–µ–Ω–∏—è
- `overall` - –û–±—â–µ–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ

**–°—Ç–∞—Ç—É—Å—ã:**
- `pending` - –û–∂–∏–¥–∞–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
- `approved` - –û–¥–æ–±—Ä–µ–Ω–æ
- `rejected` - –û—Ç–∫–ª–æ–Ω–µ–Ω–æ

---

### üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (`/api/users`)

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|---------|
| `GET` | `/api/users` | –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ |
| `GET` | `/api/users/:id` | –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |
| `GET` | `/api/users/telegram/:telegramId` | –ü–æ Telegram ID |
| `POST` | `/api/users` | –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `PUT` | `/api/users/:id` | –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `DELETE` | `/api/users/:id` | –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |

---

### üìú –ò—Å—Ç–æ—Ä–∏—è (`/api/history`)

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|---------|
| `GET` | `/api/history` | –í—Å—è –∏—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π |
| `GET` | `/api/history/type/:type` | –ò—Å—Ç–æ—Ä–∏—è –ø–æ —Ç–∏–ø—É |
| `POST` | `/api/history/:id/revert` | –û—Ç–∫–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ |

---

### ‚ù§Ô∏è Health Check

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|---------|
| `GET` | `/health` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–µ—Ä–∞ |

---

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤:
1. **–ö–æ–Ω—Å–æ–ª—å** - –¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
2. **–§–∞–π–ª—ã** - `/logs/YYYY-MM-DD.log` - JSON —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏

### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

| –£—Ä–æ–≤–µ–Ω—å | –°–∏–º–≤–æ–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|--------|---------|
| `INFO` | ‚ÑπÔ∏è | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è |
| `SUCCESS` | ‚úì | –£—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| `ERROR` | ‚úò | –û—à–∏–±–∫–∏ |
| `WARN` | ‚ö† | –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è |
| `DEBUG` | ‚óÜ | –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è |

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª–æ–≥–≥–µ—Ä–∞ –≤ –∫–æ–¥–µ

```javascript
const logger = require('../utils/logger');

logger.info('–ù–æ–≤–∞—è –∞—Ä–µ–Ω–¥–∞ —Å–æ–∑–¥–∞–Ω–∞', { rentalId: '123abc', days: 5 });
logger.success('–ê—Ä–µ–Ω–¥–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞', { totalPrice: 3000 });
logger.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è', { message: 'Console not found' });
logger.warn('–ö–æ–Ω—Å–æ–ª—å –Ω—É–∂–¥–∞–µ—Ç—Å—è —Å–µ—Ä–≤–∏—Å–∞', { hoursUntil: 24 });
logger.debug('–î–µ—Ç–∞–ª–∏ –∑–∞–ø—Ä–æ—Å–∞', { method: 'POST' });
```

---

## ü§ñ Telegram Bot

### –ö–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|---------|
| `/start` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–≤—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `/help` | –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º |

### Inline –∫–Ω–æ–ø–∫–∏

| –ö–Ω–æ–ø–∫–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|--------|-----------|
| üéÆ –ö–æ–Ω—Å–æ–ª–∏ | –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–Ω—Å–æ–ª–µ–π |
| üìã –ú–æ–∏ –∞—Ä–µ–Ω–¥—ã | –ê–∫—Ç–∏–≤–Ω—ã–µ –∞—Ä–µ–Ω–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| ‚≠ê –û—Ü–µ–Ω–∏—Ç—å | –û—Ü–µ–Ω–∏—Ç—å –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—É—é –∞—Ä–µ–Ω–¥—É |

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

- ‚úÖ –û–¥–æ–±—Ä–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞
- ‚úÖ –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞
- ‚úÖ –ù–æ–≤—ã–µ —Ä–µ–π—Ç–∏–Ω–≥–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É

---

## üì¶ npm —Å–∫—Ä–∏–ø—Ç—ã

```bash
npm start           # Production —Å–µ—Ä–≤–µ—Ä
npm run dev         # –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (—Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π)
npm run seed        # –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ë–î —Ç–µ—Å—Ç–∞–º–∏
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
backend/
‚îú‚îÄ‚îÄ models/           # Mongoose –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ routes/           # API –º–∞—Ä—à—Ä—É—Ç—ã
‚îú‚îÄ‚îÄ telegram/         # Telegram –±–æ—Ç
‚îú‚îÄ‚îÄ utils/            # –£—Ç–∏–ª–∏—Ç—ã (logger)
‚îú‚îÄ‚îÄ scripts/          # –°–∫—Ä–∏–ø—Ç—ã (seed)
‚îú‚îÄ‚îÄ logs/             # –õ–æ–≥–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ server.js         # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ .env
‚îî‚îÄ‚îÄ README.md
```

---

## üóÑÔ∏è –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### Console
```javascript
{ name, type, model, description, pricePerDay, games, isAvailable }
```

### Game
```javascript
{ name, description, genre, year, platform }
```

### User
```javascript
{ name, telegramId, telegramUsername, telegramPhotoUrl, averageRating, ratingsCount }
```

### Rental
```javascript
{ userId, consoleId, days, totalPrice, startDate, endDate, status }
```

### Discount
```javascript
{ date, percentage, description, isGlobal }
```

### Rating
```javascript
{ ratedBy, ratedUser, rentalId, rating, category, comment, status, rejectionReason }
```

### History
```javascript
{ type, action, resourceId, oldData, newData }
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö  
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Å–æ–ª–µ–π  
‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π  
‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫  

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

**–ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç:**
```bash
npm run dev  # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∑–∞–ø—É—â–µ–Ω
tail -f logs/$(date +%Y-%m-%d).log | grep ERROR
```

**MongoDB –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è:**
```bash
mongod  # –ó–∞–ø—É—Å—Ç–∏—Ç–µ MongoDB
cat .env  # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ MONGODB_URI
```

**API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 500:**
```bash
tail -f logs/$(date +%Y-%m-%d).log | grep ERROR
npm run dev  # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
```

---

**–í–µ—Ä—Å–∏—è**: 1.0.0  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
